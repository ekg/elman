CMA-ES 4D Search for mamba2
Started: 2026-02-02T09:17:08.586074
Command: python cmaes_search.py --model mamba2 --train_minutes 30 --converge 0.01 --gpus 0,1,2,3,4,5,6,7 --params 480M --output benchmark_results/cmaes_4d --start_from_best
======================================================================

/home/erikg/.local/lib/python3.12/site-packages/cma/s.py:15: UserWarning: Could not import matplotlib.pyplot, therefore ``cma.plot()`` etc. is not available
  _warnings.warn('Could not import matplotlib.pyplot, therefore'
Starting from known best config: {'dim': 1792, 'd_state': 96, 'headdim': 64, 'expand': 2, 'depth': 25, 'lr': 0.0003}
Encoded x0: ['0.375', '0.167', '0.333', '0.500', '0.375', '0.739']
======================================================================
CMA-ES Search for MAMBA2
======================================================================
Search space (6 dimensions):
  dim: [1024, 3072] (int_mult128) - Model dimension
  d_state: [64, 256] (int_mult16) - SSM state dimension
  headdim: [32, 128] (int_pow2) - Head dimension (32, 64, or 128)
  expand: [1, 3] (int) - Expansion factor
  depth: [16, 40] (int) - Number of layers
  lr: [1e-05, 0.001] (log) - Learning rate (log scale)
Target params: 480M Â± 50M
Training time per config: 30.0 min
Convergence mode: stop when improvement < 0.01
Max generations: 1000
Population: 8
GPUs: [0, 1, 2, 3, 4, 5, 6, 7] (8 parallel)
======================================================================
(4_w,8)-aCMA-ES (mu_w=2.6,w_1=52%) in dimension 6 (seed=92636, Mon Feb  2 09:17:09 2026)

--- Generation 1 (converge threshold: 0.01) ---
  [Eval 1] GPU 0 | dim=1024, d_state=64, headdim=32, expand=2, depth=20, lr=0.0001401 | dim=1024 | 131.6M params
  [Eval 1] Loss: 1.2446
  [Eval 3] GPU 2 | dim=1408, d_state=80, headdim=64, expand=2, depth=24, lr=9.92e-05 | dim=1408 | 294.9M params
  [Eval 3] Loss: 1.5732
  [Eval 2] GPU 1 | dim=1920, d_state=144, headdim=64, expand=2, depth=29, lr=8.602e-05 | dim=1920 | 656.8M params
  [Eval 2] Loss: 1.4353
  [Eval 7] GPU 6 | dim=1408, d_state=112, headdim=64, expand=2, depth=30, lr=0.0001051 | dim=1408 | 368.5M params
  [Eval 7] Loss: 1.4639
  [Eval 6] GPU 5 | dim=1664, d_state=112, headdim=32, expand=2, depth=19, lr=0.0002316 | dim=1664 | 324.6M params
  [Eval 6] Loss: 1.3551
  [Eval 5] GPU 4 | dim=1920, d_state=96, headdim=64, expand=2, depth=29, lr=0.0002565 | dim=1920 | 656.8M params
  [Eval 5] Loss: 1.2413
  [Eval 4] GPU 3 | dim=2048, d_state=80, headdim=64, expand=2, depth=23, lr=0.0001341 | dim=2048 | 592.0M params
  [Eval 4] Loss: 1.2421
  [Eval 8] GPU 7 | dim=2176, d_state=128, headdim=64, expand=2, depth=25, lr=0.0001772 | dim=2176 | 725.4M params
  [Eval 8] Loss: 1.2607
  *** NEW BEST: 1.2446 | {'dim': 1024, 'd_state': 64, 'headdim': 32, 'expand': 2, 'depth': 20, 'lr': 0.00014006487793495964} | dim=1024 ***
  *** NEW BEST: 1.2421 | {'dim': 2048, 'd_state': 80, 'headdim': 64, 'expand': 2, 'depth': 23, 'lr': 0.00013411219944284335} | dim=2048 ***
  *** NEW BEST: 1.2413 | {'dim': 1920, 'd_state': 96, 'headdim': 64, 'expand': 2, 'depth': 29, 'lr': 0.0002565304552275803} | dim=1920 ***
Iterat #Fevals   function value  axis ratio  sigma  min&max std  t[m:s]
    1      8 1.241253000000000e+00 1.0e+00 1.31e-01  1e-01  1e-01 30:20.5
  Generation best: 1.2413 | Overall best: 1.2413 | Improvement: inf

--- Generation 2 (converge threshold: 0.01) ---
  [Eval 13] GPU 4 | dim=1536, d_state=112, headdim=64, expand=1, depth=26, lr=0.0002343 | dim=1536 | 189.8M params
  [Eval 13] Loss: 1.3406
  [Eval 9] GPU 0 | dim=1664, d_state=112, headdim=64, expand=2, depth=27, lr=0.0003231 | dim=1664 | 461.0M params
  [Eval 9] Loss: 1.2534
  [Eval 12] GPU 3 | dim=1792, d_state=64, headdim=32, expand=2, depth=26, lr=5.379e-05 | dim=1792 | 513.9M params
  [Eval 12] Loss: 1.5098
  [Eval 15] GPU 6 | dim=1408, d_state=112, headdim=32, expand=2, depth=27, lr=0.0002114 | dim=1408 | 331.7M params
  [Eval 15] Loss: 1.3692
  [Eval 16] GPU 7 | dim=1792, d_state=64, headdim=64, expand=2, depth=29, lr=0.0001274 | dim=1792 | 573.1M params
  [Eval 16] Loss: 1.3130
  [Eval 11] GPU 2 | dim=2176, d_state=112, headdim=64, expand=2, depth=29, lr=0.0001614 | dim=2176 | 841.4M params
  [Eval 11] Loss: 1.2981
  [Eval 14] GPU 5 | dim=2048, d_state=144, headdim=64, expand=2, depth=26, lr=0.0001471 | dim=2048 | 669.1M params
  [Eval 14] Loss: 1.2923
  [Eval 10] GPU 1 | dim=1792, d_state=96, headdim=64, expand=2, depth=27, lr=0.000123 | dim=1792 | 533.7M params
  [Eval 10] Loss: 1.2566
    2     16 1.253398000000000e+00 1.2e+00 1.18e-01  1e-01  1e-01 60:41.5
  Generation best: 1.2534 | Overall best: 1.2413 | Improvement: 0.0000
  Improvement 0.0000 < threshold 0.01 (1 consecutive)

--- Generation 3 (converge threshold: 0.01) ---
  [Eval 17] GPU 0 | dim=1536, d_state=96, headdim=64, expand=2, depth=22, lr=0.0001755 | dim=1536 | 320.9M params
  [Eval 17] Loss: 1.4197
  [Eval 20] GPU 3 | dim=1664, d_state=112, headdim=64, expand=2, depth=23, lr=0.0001351 | dim=1664 | 392.8M params
  [Eval 20] Loss: 1.3913
  [Eval 24] GPU 7 | dim=1792, d_state=96, headdim=64, expand=2, depth=28, lr=0.0002293 | dim=1792 | 553.4M params
  [Eval 24] Loss: 1.1895
  [Eval 19] GPU 2 | dim=1920, d_state=144, headdim=64, expand=1, depth=27, lr=0.0002875 | dim=1920 | 306.0M params
  [Eval 19] Loss: 1.4698
  [Eval 18] GPU 1 | dim=1920, d_state=128, headdim=64, expand=2, depth=27, lr=0.0001489 | dim=1920 | 611.6M params
  [Eval 18] Loss: 1.3016
  [Eval 21] GPU 4 | dim=1920, d_state=128, headdim=32, expand=1, depth=27, lr=0.0001282 | dim=1920 | 306.0M params
  [Eval 21] Loss: 1.5277
  [Eval 22] GPU 5 | dim=1920, d_state=112, headdim=64, expand=2, depth=28, lr=0.0002832 | dim=1920 | 634.2M params
  [Eval 22] Loss: 1.2608
  [Eval 23] GPU 6 | dim=2048, d_state=80, headdim=64, expand=2, depth=26, lr=0.0001057 | dim=2048 | 669.1M params
  [Eval 23] Loss: 1.3783
  *** NEW BEST: 1.1895 | {'dim': 1792, 'd_state': 96, 'headdim': 64, 'expand': 2, 'depth': 28, 'lr': 0.00022926968585941878} | dim=1792 ***
    3     24 1.189544000000000e+00 1.2e+00 9.87e-02  9e-02  1e-01 91:00.4
  Generation best: 1.1895 | Overall best: 1.1895 | Improvement: 0.0517

--- Generation 4 (converge threshold: 0.01) ---
  [Eval 27] GPU 2 | dim=1408, d_state=112, headdim=64, expand=2, depth=27, lr=0.0002922 | dim=1408 | 331.7M params
  [Eval 27] Loss: 1.3222
  [Eval 31] GPU 6 | dim=1664, d_state=80, headdim=64, expand=2, depth=28, lr=0.0002796 | dim=1664 | 478.1M params
  [Eval 31] Loss: 1.2557
  [Eval 30] GPU 5 | dim=1792, d_state=112, headdim=64, expand=2, depth=27, lr=0.0002593 | dim=1792 | 533.7M params
  [Eval 30] Loss: 1.1633
  [Eval 29] GPU 4 | dim=1792, d_state=112, headdim=32, expand=2, depth=32, lr=0.0003506 | dim=1792 | 632.4M params
  [Eval 29] Loss: 1.2585
  [Eval 26] GPU 1 | dim=1792, d_state=144, headdim=64, expand=2, depth=28, lr=0.000241 | dim=1792 | 553.4M params
  [Eval 26] Loss: 1.1717
  [Eval 28] GPU 3 | dim=2048, d_state=96, headdim=64, expand=2, depth=27, lr=0.0003391 | dim=2048 | 694.8M params
  [Eval 28] Loss: 1.2769
  [Eval 25] GPU 0 | dim=2176, d_state=96, headdim=64, expand=2, depth=25, lr=0.000291 | dim=2176 | 725.4M params
  [Eval 25] Loss: 1.2315
  [Eval 32] GPU 7 | dim=2048, d_state=80, headdim=64, expand=2, depth=28, lr=0.0001554 | dim=2048 | 720.5M params
  [Eval 32] Loss: 1.2861
  *** NEW BEST: 1.1717 | {'dim': 1792, 'd_state': 144, 'headdim': 64, 'expand': 2, 'depth': 28, 'lr': 0.00024098884724123274} | dim=1792 ***
  *** NEW BEST: 1.1633 | {'dim': 1792, 'd_state': 112, 'headdim': 64, 'expand': 2, 'depth': 27, 'lr': 0.0002593423820960481} | dim=1792 ***
    4     32 1.163316000000000e+00 1.2e+00 9.58e-02  8e-02  1e-01 121:19.8
  Generation best: 1.1633 | Overall best: 1.1633 | Improvement: 0.0262

--- Generation 5 (converge threshold: 0.01) ---
  [Eval 33] GPU 0 | dim=1536, d_state=96, headdim=64, expand=2, depth=28, lr=0.0003965 | dim=1536 | 408.3M params
  [Eval 33] Loss: 1.2702
  [Eval 36] GPU 3 | dim=1536, d_state=128, headdim=64, expand=2, depth=29, lr=0.0002612 | dim=1536 | 422.8M params
  [Eval 36] Loss: 1.2627
  [Eval 34] GPU 1 | dim=1664, d_state=128, headdim=64, expand=2, depth=30, lr=0.0001641 | dim=1664 | 512.2M params
  [Eval 34] Loss: 1.2186
  [Eval 37] GPU 4 | dim=1792, d_state=144, headdim=64, expand=2, depth=30, lr=0.0004081 | dim=1792 | 592.9M params
  [Eval 37] Loss: 1.2683
  [Eval 35] GPU 2 | dim=1920, d_state=96, headdim=64, expand=2, depth=29, lr=0.0002725 | dim=1920 | 656.8M params
  [Eval 35] Loss: 1.2434
  [Eval 38] GPU 5 | dim=2048, d_state=96, headdim=64, expand=2, depth=23, lr=0.0002442 | dim=2048 | 592.0M params
  [Eval 38] Loss: 1.1704
  [Eval 40] GPU 7 | dim=2304, d_state=112, headdim=64, expand=2, depth=27, lr=0.0002051 | dim=2304 | 877.2M params
  [Eval 40] Loss: 1.2734
  [Eval 39] GPU 6 | dim=2048, d_state=80, headdim=64, expand=2, depth=28, lr=0.0002633 | dim=2048 | 720.5M params
  [Eval 39] Loss: 1.2502
    5     40 1.170389000000000e+00 1.3e+00 7.93e-02  6e-02  8e-02 151:41.8
  Generation best: 1.1704 | Overall best: 1.1633 | Improvement: 0.0000
  Improvement 0.0000 < threshold 0.01 (1 consecutive)

--- Generation 6 (converge threshold: 0.01) ---
  [Eval 46] GPU 5 | dim=1792, d_state=112, headdim=64, expand=2, depth=26, lr=0.0003854 | dim=1792 | 513.9M params
  [Eval 46] Loss: 1.1701
  [Eval 44] GPU 3 | dim=1792, d_state=96, headdim=64, expand=2, depth=28, lr=0.0001794 | dim=1792 | 553.4M params
  [Eval 44] Loss: 1.2009
  [Eval 42] GPU 1 | dim=1792, d_state=128, headdim=64, expand=2, depth=28, lr=0.0001873 | dim=1792 | 553.4M params
  [Eval 42] Loss: 1.1930
  [Eval 43] GPU 2 | dim=1792, d_state=96, headdim=64, expand=2, depth=29, lr=0.0002861 | dim=1792 | 573.1M params
  [Eval 43] Loss: 1.2358
  [Eval 45] GPU 4 | dim=1920, d_state=80, headdim=64, expand=2, depth=28, lr=0.0001895 | dim=1920 | 634.2M params
  [Eval 45] Loss: 1.2490
  [Eval 47] GPU 6 | dim=2048, d_state=112, headdim=64, expand=1, depth=26, lr=0.0003155 | dim=2048 | 334.8M params
  [Eval 47] Loss: 1.4080
  [Eval 48] GPU 7 | dim=2048, d_state=128, headdim=64, expand=2, depth=29, lr=0.0002255 | dim=2048 | 746.3M params
  [Eval 48] Loss: 1.2552
  [Eval 41] GPU 0 | dim=1920, d_state=128, headdim=64, expand=2, depth=24, lr=0.0001763 | dim=1920 | 543.7M params
  [Eval 41] Loss: 1.2749
    6     48 1.170063000000000e+00 1.3e+00 7.37e-02  6e-02  7e-02 182:02.4
  Generation best: 1.1701 | Overall best: 1.1633 | Improvement: 0.0000
  Improvement 0.0000 < threshold 0.01 (2 consecutive)

*** CONVERGED: improvement 0.0000 < 0.01 ***

======================================================================
SEARCH COMPLETE
======================================================================
Best loss: 1.1633
Best params: {'dim': 1792, 'd_state': 112, 'headdim': 64, 'expand': 2, 'depth': 27, 'lr': 0.0002593423820960481}
Total evaluations: 48

Cleaning up 271 checkpoint files...
Cleanup complete.

To train with best config:
python train.py --level mamba2 --dim 1792 --depth 27 --lr 0.0002593423820960481 --train_minutes 30

======================================================================
Finished: 2026-02-02T12:20:55.249880
Duration: 3.06 hours
Return code: 0
