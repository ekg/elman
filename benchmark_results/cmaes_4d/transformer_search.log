CMA-ES 4D Search for transformer
Started: 2026-02-03T09:45:47.886261
Command: python cmaes_search.py --model transformer --train_minutes 30 --converge 0.01 --gpus 0,1,2,3,4,5,6,7 --params 480M --output benchmark_results/cmaes_4d --start_from_best
======================================================================

/home/erikg/.local/lib/python3.12/site-packages/cma/s.py:15: UserWarning: Could not import matplotlib.pyplot, therefore ``cma.plot()`` etc. is not available
  _warnings.warn('Could not import matplotlib.pyplot, therefore'
Starting from known best config: {'dim': 1536, 'n_heads': 16, 'expansion': 4, 'depth': 24, 'dropout': 0.0, 'lr': 0.0001}
Encoded x0: ['0.250', '0.333', '0.500', '0.500', '0.000', '0.500']
======================================================================
CMA-ES Search for TRANSFORMER
======================================================================
Search space (6 dimensions):
  dim: [1024, 3072] (int_mult128) - Model dimension
  n_heads: [8, 32] (int) - Number of attention heads
  expansion: [2, 6] (int) - FFN expansion factor
  depth: [12, 36] (int) - Number of layers
  dropout: [0.0, 0.15] (float) - Dropout rate
  lr: [1e-05, 0.001] (log) - Learning rate (log scale)
Target params: 480M Â± 50M
Training time per config: 30.0 min
Convergence mode: stop when improvement < 0.01
Max generations: 1000
Population: 8
GPUs: [0, 1, 2, 3, 4, 5, 6, 7] (8 parallel)
======================================================================
(4_w,8)-aCMA-ES (mu_w=2.6,w_1=52%) in dimension 6 (seed=210122, Tue Feb  3 09:45:48 2026)

--- Generation 1 (converge threshold: 0.01) ---
  [Eval 1] GPU 0 | dim=1280, n_heads=13, expansion=5, depth=24, dropout=0.01081, lr=8.493e-05 | dim=1280 | 747.5M params
  [Eval 1] Loss: 2.0867
  [Eval 5] GPU 4 | dim=1024, n_heads=15, expansion=5, depth=23, dropout=9.253e-05, lr=0.0001093 | dim=1024 | 458.5M params
  [Eval 5] Loss: 2.1032
  [Eval 4] GPU 3 | dim=1536, n_heads=17, expansion=4, depth=23, dropout=0.05164, lr=0.0003142 | dim=1536 | 868.7M params
  [Eval 4] Loss: 1.4356
  [Eval 3] GPU 2 | dim=1408, n_heads=13, expansion=5, depth=18, dropout=0.01088, lr=0.0001757 | dim=1408 | 678.4M params
  [Eval 3] Loss: 1.5676
  [Eval 6] GPU 5 | dim=1920, n_heads=14, expansion=4, depth=23, dropout=0.007789, lr=0.0001204 | dim=1920 | 1357.2M params
  [Eval 6] Loss: 1.7961
  [Eval 2] GPU 1 | dim=1536, n_heads=15, expansion=3, depth=29, dropout=0.005153, lr=8.315e-05 | dim=1536 | 889.9M params
  [Eval 2] Loss: 2.0696
  [Eval 7] GPU 6 | dim=2176, n_heads=20, expansion=3, depth=26, dropout=0.001409, lr=0.0001542 | dim=2176 | 1601.1M params
  [Eval 7] Loss: 1.7020
  [Eval 8] GPU 7 | dim=1792, n_heads=19, expansion=4, depth=26, dropout=0.001076, lr=8.592e-05 | dim=1792 | 1336.4M params
  [Eval 8] Loss: 2.0673
  *** NEW BEST: 2.0867 | {'dim': 1280, 'n_heads': 13, 'expansion': 5, 'depth': 24, 'dropout': 0.010806140383697779, 'lr': 8.493141366937396e-05} | dim=1280 ***
  *** NEW BEST: 2.0696 | {'dim': 1536, 'n_heads': 15, 'expansion': 3, 'depth': 29, 'dropout': 0.005153328423941676, 'lr': 8.314573080373795e-05} | dim=1536 ***
  *** NEW BEST: 1.5676 | {'dim': 1408, 'n_heads': 13, 'expansion': 5, 'depth': 18, 'dropout': 0.010878663155661649, 'lr': 0.00017568671806339887} | dim=1408 ***
  *** NEW BEST: 1.4356 | {'dim': 1536, 'n_heads': 17, 'expansion': 4, 'depth': 23, 'dropout': 0.051643227786561274, 'lr': 0.0003141601212504568} | dim=1536 ***
Iterat #Fevals   function value  axis ratio  sigma  min&max std  t[m:s]
    1      8 1.435618000000000e+00 1.0e+00 1.53e-01  1e-01  2e-01 30:31.4
  Generation best: 1.4356 | Overall best: 1.4356 | Improvement: inf

--- Generation 2 (converge threshold: 0.01) ---
  [Eval 10] GPU 1 | dim=1152, n_heads=20, expansion=4, depth=17, dropout=0.00295, lr=0.0007478 | dim=1152 | 361.3M params
  [Eval 10] Loss: 1.3434
  [Eval 16] GPU 7 | dim=1280, n_heads=23, expansion=5, depth=20, dropout=0.04938, lr=0.000208 | dim=1280 | 623.0M params
  [Eval 16] Loss: 1.6340
  [Eval 14] GPU 5 | dim=1792, n_heads=19, expansion=4, depth=12, dropout=0.01839, lr=6.02e-05 | dim=1792 | 617.1M params
  [Eval 14] Loss: 2.2451
  [Eval 13] GPU 4 | dim=1408, n_heads=19, expansion=4, depth=22, dropout=0.00321, lr=0.0001869 | dim=1408 | 698.2M params
  [Eval 13] Loss: 1.5887
  [Eval 12] GPU 3 | dim=1280, n_heads=16, expansion=5, depth=24, dropout=0.01039, lr=0.0004045 | dim=1280 | 747.5M params
  [Eval 12] Loss: 1.3890
  [Eval 15] GPU 6 | dim=1664, n_heads=17, expansion=4, depth=23, dropout=0.05546, lr=0.0004299 | dim=1664 | 1019.5M params
  [Eval 15] Loss: 1.3878
  [Eval 11] GPU 2 | dim=1408, n_heads=17, expansion=5, depth=31, dropout=0.01945, lr=0.0008817 | dim=1408 | 1168.1M params
  [Eval 11] Loss: 1.4971
  [Eval 9] GPU 0 | dim=2304, n_heads=17, expansion=4, depth=23, dropout=0.0133, lr=0.000734 | dim=2304 | 1954.2M params
  [Eval 9] Loss: 1.6716
  *** NEW BEST: 1.3434 | {'dim': 1152, 'n_heads': 20, 'expansion': 4, 'depth': 17, 'dropout': 0.002949919020392288, 'lr': 0.0007478214255242831} | dim=1152 ***
    2     16 1.343419000000000e+00 1.3e+00 1.68e-01  2e-01  2e-01 61:01.6
  Generation best: 1.3434 | Overall best: 1.3434 | Improvement: 0.0922

--- Generation 3 (converge threshold: 0.01) ---
  [Eval 21] GPU 4 | dim=1280, n_heads=20, expansion=4, depth=17, dropout=0.04657, lr=0.000619 | dim=1280 | 446.0M params
  [Eval 21] Loss: 1.3648
  [Eval 22] GPU 5 | dim=1024, n_heads=23, expansion=5, depth=19, dropout=0.03029, lr=0.0007821 | dim=1024 | 378.8M params
  [Eval 22] Loss: 1.3792
  [Eval 17] GPU 0 | dim=1024, n_heads=9, expansion=3, depth=24, dropout=0.07228, lr=0.0003208 | dim=1024 | 327.5M params
  [Eval 17] Loss: 1.6513
  [Eval 20] GPU 3 | dim=1280, n_heads=19, expansion=5, depth=18, dropout=8.163e-07, lr=0.0005692 | dim=1280 | 560.7M params
  [Eval 20] Loss: 1.2520
  [Eval 23] GPU 6 | dim=1152, n_heads=15, expansion=4, depth=22, dropout=0.0001272, lr=0.000333 | dim=1152 | 467.5M params
  [Eval 23] Loss: 1.4584
  [Eval 19] GPU 2 | dim=1408, n_heads=20, expansion=5, depth=20, dropout=0.02572, lr=0.0005214 | dim=1408 | 753.8M params
  [Eval 19] Loss: 1.3586
  [Eval 18] GPU 1 | dim=1792, n_heads=18, expansion=5, depth=13, dropout=0.06874, lr=0.000611 | dim=1792 | 793.7M params
  [Eval 18] Loss: 1.2888
  [Eval 24] GPU 7 | dim=1408, n_heads=15, expansion=4, depth=18, dropout=0.000359, lr=0.0009995 | dim=1408 | 571.4M params
  [Eval 24] Loss: 1.3717
  *** NEW BEST: 1.2888 | {'dim': 1792, 'n_heads': 18, 'expansion': 5, 'depth': 13, 'dropout': 0.06874081067871, 'lr': 0.0006110425912198219} | dim=1792 ***
  *** NEW BEST: 1.2520 | {'dim': 1280, 'n_heads': 19, 'expansion': 5, 'depth': 18, 'dropout': 8.162817657204363e-07, 'lr': 0.0005692143260734845} | dim=1280 ***
    3     24 1.251972000000000e+00 1.5e+00 1.82e-01  2e-01  2e-01 91:19.7
  Generation best: 1.2520 | Overall best: 1.2520 | Improvement: 0.0914

--- Generation 4 (converge threshold: 0.01) ---
  [Eval 27] GPU 2 | dim=1024, n_heads=19, expansion=4, depth=12, dropout=0.0002495, lr=0.0003329 | dim=1024 | 201.6M params
  [Eval 27] Loss: 1.5724
  [Eval 32] GPU 7 | dim=1664, n_heads=21, expansion=4, depth=13, dropout=0.006109, lr=0.000922 | dim=1664 | 576.4M params
  [Eval 32] Loss: 1.3873
  [Eval 31] GPU 6 | dim=1280, n_heads=19, expansion=5, depth=26, dropout=0.05082, lr=0.0003761 | dim=1280 | 809.8M params
  [Eval 31] Loss: 1.4240
  [Eval 26] GPU 1 | dim=1152, n_heads=20, expansion=4, depth=19, dropout=0.0002409, lr=0.000622 | dim=1152 | 403.8M params
  [Eval 26] Loss: 1.3507
  [Eval 29] GPU 4 | dim=1664, n_heads=23, expansion=4, depth=12, dropout=0.04929, lr=0.0006913 | dim=1664 | 532.1M params
  [Eval 29] Loss: 1.2816
  [Eval 30] GPU 5 | dim=1024, n_heads=21, expansion=5, depth=20, dropout=0.1009, lr=0.0007986 | dim=1024 | 398.8M params
  [Eval 30] Loss: 1.4018
  [Eval 28] GPU 3 | dim=1152, n_heads=13, expansion=6, depth=16, dropout=0.03932, lr=0.0006251 | dim=1152 | 467.5M params
  [Eval 28] Loss: 1.3828
  [Eval 25] GPU 0 | dim=1408, n_heads=16, expansion=4, depth=12, dropout=0.0006998, lr=0.0007391 | dim=1408 | 381.0M params
  [Eval 25] Loss: 1.3647
    4     32 1.281604000000000e+00 1.7e+00 1.98e-01  2e-01  3e-01 121:39.6
  Generation best: 1.2816 | Overall best: 1.2520 | Improvement: 0.0000
  Improvement 0.0000 < threshold 0.01 (1 consecutive)

--- Generation 5 (converge threshold: 0.01) ---
  [Eval 37] GPU 4 | dim=1024, n_heads=23, expansion=6, depth=15, dropout=0.02135, lr=0.0003272 | dim=1024 | 346.3M params
  [Eval 37] Loss: 1.6158
  [Eval 40] GPU 7 | dim=1408, n_heads=21, expansion=4, depth=22, dropout=0.04495, lr=0.0002316 | dim=1408 | 698.2M params
  [Eval 40] Loss: 1.5466
  [Eval 34] GPU 1 | dim=1408, n_heads=18, expansion=5, depth=14, dropout=0.01377, lr=0.0009645 | dim=1408 | 527.7M params
  [Eval 34] Loss: 1.4136
  [Eval 36] GPU 3 | dim=1664, n_heads=18, expansion=5, depth=18, dropout=0.01309, lr=0.000642 | dim=1664 | 947.4M params
  [Eval 36] Loss: 1.3658
  [Eval 33] GPU 0 | dim=1664, n_heads=31, expansion=4, depth=12, dropout=0.06742, lr=0.0001272 | dim=1664 | 532.1M params
  [Eval 33] Loss: 1.8028
  [Eval 38] GPU 5 | dim=1536, n_heads=10, expansion=5, depth=21, dropout=0.002945, lr=0.0009816 | dim=1536 | 941.8M params
  [Eval 38] Loss: 1.3476
  [Eval 39] GPU 6 | dim=1536, n_heads=17, expansion=5, depth=16, dropout=0.02637, lr=0.0002852 | dim=1536 | 717.7M params
  [Eval 39] Loss: 1.3621
  [Eval 35] GPU 2 | dim=1152, n_heads=28, expansion=3, depth=14, dropout=0.04623, lr=0.0001211 | dim=1152 | 241.9M params
  [Eval 35] Loss: 2.1421
    5     40 1.347558000000000e+00 2.0e+00 2.25e-01  2e-01  3e-01 151:59.2
  Generation best: 1.3476 | Overall best: 1.2520 | Improvement: 0.0000
  Improvement 0.0000 < threshold 0.01 (2 consecutive)

*** CONVERGED: improvement 0.0000 < 0.01 ***

======================================================================
SEARCH COMPLETE
======================================================================
Best loss: 1.2520
Best params: {'dim': 1280, 'n_heads': 19, 'expansion': 5, 'depth': 18, 'dropout': 8.162817657204363e-07, 'lr': 0.0005692143260734845}
Total evaluations: 40

Cleaning up 231 checkpoint files...
Cleanup complete.

To train with best config:
python train.py --level llama --dim 1280 --depth 18 --n_heads 19 --expansion 5 --lr 0.0005692143260734845 --train_minutes 30

======================================================================
Finished: 2026-02-03T12:19:21.839649
Duration: 2.56 hours
Return code: 0
