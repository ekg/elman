/home/erikg/.local/lib/python3.12/site-packages/cma/s.py:15: UserWarning: Could not import matplotlib.pyplot, therefore ``cma.plot()`` etc. is not available
  _warnings.warn('Could not import matplotlib.pyplot, therefore'
Starting from known best config: {'n_heads': 104, 'n_state': 32, 'depth': 32}
Encoded x0: ['0.417', '0.333', '0.600']
======================================================================
CMA-ES Search for E88
======================================================================
Search space (3 dimensions):
  n_heads: [64, 160] (int) - Number of attention heads
  n_state: [16, 64] (e88_n_state) - State dimension (only 16,32,48,64 supported by fused kernel)
  depth: [20, 40] (int) - Number of layers
Target params: 480M Â± 20M
Training time per config: 10.0 min
Generations: 15
Population: 8
GPUs: [0, 1, 2, 3, 4, 5, 6, 7] (8 parallel)
Total evaluations: ~120
Estimated time: ~150 min (2.5 hours)
======================================================================
(4_w,8)-aCMA-ES (mu_w=2.6,w_1=52%) in dimension 3 (seed=618180, Mon Jan 26 14:28:38 2026)

--- Generation 1/15 ---
  [Eval 2] Skip - params 529.9M vs target 480M
  [Eval 6] GPU 5 | n_heads=111, n_state=16, depth=37 | dim=1408 | 468.8M params
  [Eval 6] Loss: 1.6317
  [Eval 4] Skip - params 523.5M vs target 480M
  [Eval 8] Skip - params 503.2M vs target 480M
  [Eval 1] GPU 0 | n_heads=126, n_state=16, depth=34 | dim=1408 | 489.0M params
  [Eval 1] Loss: 1.5066
  [Eval 7] GPU 6 | n_heads=100, n_state=16, depth=29 | dim=2048 | 481.7M params
  [Eval 7] Loss: 1.4686
  [Eval 5] GPU 4 | n_heads=100, n_state=16, depth=28 | dim=2176 | 494.1M params
  [Eval 5] Loss: 1.4560
  [Eval 3] GPU 2 | n_heads=118, n_state=32, depth=32 | dim=768 | 467.1M params
  [Eval 3] Loss: 1.7083
  *** NEW BEST: 1.5066 | {'n_heads': 126, 'n_state': 16, 'depth': 34} | dim=1408 ***
  *** NEW BEST: 1.4560 | {'n_heads': 100, 'n_state': 16, 'depth': 28} | dim=2176 ***
Iterat #Fevals   function value  axis ratio  sigma  min&max std  t[m:s]
    1      8 1.456000000000000e+00 1.0e+00 1.80e-01  2e-01  2e-01 10:21.3

--- Generation 2/15 ---
  [Eval 13] Skip - params 456.7M vs target 480M
  [Eval 15] GPU 6 | n_heads=135, n_state=16, depth=28 | dim=1536 | 470.7M params
  [Eval 15] Loss: 1.5994
  [Eval 12] GPU 3 | n_heads=103, n_state=16, depth=26 | dim=2176 | 472.6M params
  [Eval 12] Loss: 1.6267
  [Eval 14] GPU 5 | n_heads=92, n_state=16, depth=31 | dim=2048 | 473.7M params
  [Eval 14] Loss: 1.7096
  [Eval 11] GPU 2 | n_heads=84, n_state=16, depth=29 | dim=2432 | 480.6M params
  [Eval 11] Loss: 1.4594
  [Eval 9] GPU 0 | n_heads=93, n_state=16, depth=31 | dim=2048 | 478.9M params
  [Eval 9] Loss: 1.8686
  [Eval 16] GPU 7 | n_heads=118, n_state=32, depth=29 | dim=896 | 493.9M params
  [Eval 16] Loss: 1.5974
  [Eval 10] GPU 1 | n_heads=114, n_state=16, depth=26 | dim=2048 | 492.3M params
  [Eval 10] Loss: 1.4493
  *** NEW BEST: 1.4493 | {'n_heads': 114, 'n_state': 16, 'depth': 26} | dim=2048 ***
    2     16 1.449326000000000e+00 1.4e+00 2.07e-01  2e-01  3e-01 20:38.7

--- Generation 3/15 ---
  [Eval 23] Skip - params 503.3M vs target 480M
  [Eval 20] GPU 3 | n_heads=114, n_state=16, depth=26 | dim=2048 | 492.3M params
  [Eval 20] Loss: 1.4535
  [Eval 24] GPU 7 | n_heads=112, n_state=32, depth=26 | dim=1024 | 480.4M params
  [Eval 24] Loss: 1.5382
  [Eval 17] GPU 0 | n_heads=109, n_state=16, depth=25 | dim=2176 | 480.9M params
  [Eval 17] Loss: 1.4379
  [Eval 22] GPU 5 | n_heads=94, n_state=16, depth=32 | dim=1920 | 468.4M params
  [Eval 22] Loss: 1.7658
  [Eval 18] GPU 1 | n_heads=101, n_state=16, depth=25 | dim=2304 | 471.9M params
  [Eval 18] Loss: 1.6054
  [Eval 21] GPU 4 | n_heads=117, n_state=32, depth=28 | dim=896 | 472.8M params
  [Eval 21] Loss: 1.5699
  [Eval 19] GPU 2 | n_heads=82, n_state=32, depth=32 | dim=1152 | 487.0M params
  [Eval 19] Loss: 1.5593
  *** NEW BEST: 1.4379 | {'n_heads': 109, 'n_state': 16, 'depth': 25} | dim=2176 ***
    3     24 1.437901000000000e+00 2.3e+00 2.03e-01  2e-01  2e-01 30:55.5

--- Generation 4/15 ---
  [Eval 31] GPU 6 | n_heads=64, n_state=32, depth=28 | dim=1664 | 480.6M params
  [Eval 31] Loss: 1.4532
  [Eval 32] GPU 7 | n_heads=131, n_state=16, depth=27 | dim=1664 | 477.2M params
  [Eval 32] Loss: 1.5435
  [Eval 28] Skip - params 509.4M vs target 480M
  [Eval 27] GPU 2 | n_heads=124, n_state=32, depth=32 | dim=768 | 490.9M params
  [Eval 27] Loss: 1.8126
  [Eval 25] GPU 0 | n_heads=133, n_state=16, depth=26 | dim=1664 | 466.6M params
  [Eval 25] Loss: 1.5434
  [Eval 30] GPU 5 | n_heads=115, n_state=32, depth=22 | dim=1152 | 469.6M params
  [Eval 30] Loss: 1.5815
  [Eval 29] GPU 4 | n_heads=127, n_state=16, depth=29 | dim=1664 | 496.9M params
  [Eval 29] Loss: 1.4882
  [Eval 26] GPU 1 | n_heads=104, n_state=32, depth=29 | dim=1024 | 497.5M params
  [Eval 26] Loss: 1.5466
    4     32 1.453228000000000e+00 2.2e+00 1.95e-01  2e-01  2e-01 41:12.1

--- Generation 5/15 ---
  [Eval 33] Skip - params 507.3M vs target 480M
  [Eval 34] GPU 1 | n_heads=103, n_state=16, depth=23 | dim=2560 | 492.0M params
  [Eval 34] Loss: 1.4444
  [Eval 36] GPU 3 | n_heads=69, n_state=32, depth=24 | dim=1792 | 478.3M params
  [Eval 36] Loss: 1.7707
  [Eval 35] Skip - params 521.4M vs target 480M
  [Eval 39] GPU 6 | n_heads=91, n_state=16, depth=28 | dim=2304 | 476.2M params
  [Eval 39] Loss: 1.7070
  [Eval 38] GPU 5 | n_heads=107, n_state=32, depth=37 | dim=768 | 489.8M params
  [Eval 38] Loss: 1.9513
  [Eval 37] Skip - params 456.3M vs target 480M
  [Eval 40] GPU 7 | n_heads=68, n_state=32, depth=26 | dim=1664 | 474.1M params
  [Eval 40] Loss: 1.5237
    5     40 1.444361000000000e+00 2.3e+00 1.97e-01  2e-01  2e-01 51:28.2

--- Generation 6/15 ---
  [Eval 47] Skip - params 459.0M vs target 480M
  [Eval 43] GPU 2 | n_heads=77, n_state=16, depth=23 | dim=3328 | 478.3M params
  [Eval 43] Loss: 1.5542
  [Eval 48] Skip - params 500.9M vs target 480M
  [Eval 41] GPU 0 | n_heads=101, n_state=16, depth=26 | dim=2304 | 490.7M params
  [Eval 41] Loss: 1.4438
  [Eval 46] GPU 5 | n_heads=77, n_state=32, depth=28 | dim=1408 | 489.1M params
  [Eval 46] Loss: 1.4963
  [Eval 45] GPU 4 | n_heads=108, n_state=32, depth=31 | dim=896 | 483.2M params
  [Eval 45] Loss: 1.6028
  [Eval 42] GPU 1 | n_heads=79, n_state=16, depth=27 | dim=2816 | 487.3M params
  [Eval 42] Loss: 1.4540
  [Eval 44] GPU 3 | n_heads=114, n_state=16, depth=31 | dim=1664 | 476.8M params
  [Eval 44] Loss: 1.5592
    6     48 1.443828000000000e+00 2.1e+00 1.65e-01  1e-01  2e-01 61:45.5

--- Generation 7/15 ---
  [Eval 53] GPU 4 | n_heads=70, n_state=32, depth=25 | dim=1664 | 469.3M params
  [Eval 53] Loss: 1.5229
  [Eval 50] GPU 1 | n_heads=93, n_state=16, depth=24 | dim=2688 | 486.7M params
  [Eval 50] Loss: 1.4476
  [Eval 55] GPU 6 | n_heads=71, n_state=16, depth=23 | dim=3584 | 475.1M params
  [Eval 55] Loss: 1.5310
  [Eval 49] GPU 0 | n_heads=73, n_state=16, depth=24 | dim=3328 | 473.2M params
  [Eval 49] Loss: 1.5620
  [Eval 51] GPU 2 | n_heads=86, n_state=16, depth=30 | dim=2304 | 482.2M params
  [Eval 51] Loss: 1.4754
  [Eval 56] GPU 7 | n_heads=78, n_state=32, depth=23 | dim=1664 | 481.1M params
  [Eval 56] Loss: 1.4494
  [Eval 54] GPU 5 | n_heads=106, n_state=16, depth=29 | dim=1920 | 478.6M params
  [Eval 54] Loss: 1.7781
  [Eval 52] GPU 3 | n_heads=90, n_state=16, depth=29 | dim=2304 | 487.8M params
  [Eval 52] Loss: 1.4595
    7     56 1.447625000000000e+00 2.3e+00 1.68e-01  1e-01  2e-01 72:02.6

--- Generation 8/15 ---
  [Eval 59] GPU 2 | n_heads=97, n_state=16, depth=25 | dim=2432 | 478.4M params
  [Eval 59] Loss: 1.6305
  [Eval 64] GPU 7 | n_heads=66, n_state=16, depth=29 | dim=3072 | 477.1M params
  [Eval 64] Loss: 1.5501
  [Eval 57] GPU 0 | n_heads=107, n_state=16, depth=25 | dim=2176 | 472.1M params
  [Eval 57] Loss: 1.7173
  [Eval 60] GPU 3 | n_heads=99, n_state=16, depth=24 | dim=2432 | 468.7M params
  [Eval 60] Loss: 1.5938
  [Eval 58] GPU 1 | n_heads=86, n_state=16, depth=26 | dim=2688 | 487.6M params
  [Eval 58] Loss: 1.4495
  [Eval 61] GPU 4 | n_heads=88, n_state=32, depth=20 | dim=1664 | 472.0M params
  [Eval 61] Loss: 1.5386
  [Eval 62] GPU 5 | n_heads=76, n_state=32, depth=23 | dim=1664 | 468.8M params
  [Eval 62] Loss: 1.8165
  [Eval 63] GPU 6 | n_heads=119, n_state=32, depth=22 | dim=1152 | 485.9M params
  [Eval 63] Loss: 1.5243
    8     64 1.449458000000000e+00 2.4e+00 2.14e-01  2e-01  3e-01 82:25.0

--- Generation 9/15 ---
  [Eval 67] GPU 2 | n_heads=92, n_state=32, depth=27 | dim=1152 | 461.0M params
  [Eval 67] Loss: 1.6038
  [Eval 70] GPU 5 | n_heads=104, n_state=48, depth=21 | dim=896 | 471.9M params
  [Eval 70] Loss: 1.7326
  [Eval 71] GPU 6 | n_heads=80, n_state=32, depth=23 | dim=1664 | 493.4M params
  [Eval 71] Loss: 1.4343
  [Eval 65] GPU 0 | n_heads=71, n_state=16, depth=31 | dim=2688 | 480.0M params
  [Eval 65] Loss: 1.6252
  [Eval 68] GPU 3 | n_heads=85, n_state=48, depth=21 | dim=1152 | 495.9M params
  [Eval 68] Loss: 1.6433
  [Eval 66] GPU 1 | n_heads=83, n_state=16, depth=27 | dim=2688 | 488.7M params
  [Eval 66] Loss: 1.4531
  [Eval 69] GPU 4 | n_heads=103, n_state=32, depth=25 | dim=1152 | 477.9M params
  [Eval 69] Loss: 1.5873
  [Eval 72] GPU 7 | n_heads=114, n_state=16, depth=31 | dim=1664 | 476.8M params
  [Eval 72] Loss: 1.5871
  *** NEW BEST: 1.4343 | {'n_heads': 80, 'n_state': 32, 'depth': 23} | dim=1664 ***
    9     72 1.434345000000000e+00 2.6e+00 2.24e-01  2e-01  3e-01 92:42.6

--- Generation 10/15 ---
  [Eval 73] GPU 0 | n_heads=93, n_state=32, depth=26 | dim=1280 | 498.7M params
  [Eval 73] Loss: 1.5072
  [Eval 79] GPU 6 | n_heads=72, n_state=48, depth=21 | dim=1280 | 466.8M params
  [Eval 79] Loss: 1.5904
  [Eval 75] GPU 2 | n_heads=65, n_state=16, depth=24 | dim=3840 | 486.3M params
  [Eval 75] Loss: 1.4127
  [Eval 78] GPU 5 | n_heads=80, n_state=32, depth=25 | dim=1536 | 495.0M params
  [Eval 78] Loss: 1.4489
  [Eval 74] GPU 1 | n_heads=73, n_state=32, depth=24 | dim=1664 | 469.8M params
  [Eval 74] Loss: 1.8174
  [Eval 77] GPU 4 | n_heads=86, n_state=16, depth=26 | dim=2688 | 487.6M params
  [Eval 77] Loss: 1.4514
  [Eval 80] GPU 7 | n_heads=68, n_state=16, depth=21 | dim=4096 | 474.9M params
  [Eval 80] Loss: 1.5185
  [Eval 76] GPU 3 | n_heads=76, n_state=16, depth=26 | dim=2944 | 472.0M params
  [Eval 76] Loss: 1.5629
  *** NEW BEST: 1.4127 | {'n_heads': 65, 'n_state': 16, 'depth': 24} | dim=3840 ***
   10     80 1.412657000000000e+00 2.3e+00 2.21e-01  2e-01  3e-01 103:00.9

--- Generation 11/15 ---
  [Eval 85] GPU 4 | n_heads=73, n_state=16, depth=30 | dim=2688 | 477.6M params
  [Eval 85] Loss: 1.6359
  [Eval 82] GPU 1 | n_heads=96, n_state=16, depth=23 | dim=2688 | 481.5M params
  [Eval 82] Loss: 1.4418
  [Eval 83] GPU 2 | n_heads=71, n_state=32, depth=20 | dim=2048 | 468.8M params
  [Eval 83] Loss: 1.6866
  [Eval 88] GPU 7 | n_heads=65, n_state=16, depth=25 | dim=3584 | 472.8M params
  [Eval 88] Loss: 1.5349
  [Eval 81] GPU 0 | n_heads=82, n_state=16, depth=25 | dim=2944 | 489.7M params
  [Eval 81] Loss: 1.4481
  [Eval 84] GPU 3 | n_heads=79, n_state=32, depth=23 | dim=1664 | 487.3M params
  [Eval 84] Loss: 1.4400
  [Eval 87] GPU 6 | n_heads=74, n_state=16, depth=28 | dim=2816 | 473.4M params
  [Eval 87] Loss: 1.5926
  [Eval 86] GPU 5 | n_heads=86, n_state=32, depth=20 | dim=1792 | 496.7M params
  [Eval 86] Loss: 1.4336
Iterat #Fevals   function value  axis ratio  sigma  min&max std  t[m:s]
   11     88 1.433599000000000e+00 2.8e+00 2.16e-01  2e-01  3e-01 113:19.4

--- Generation 12/15 ---
  [Eval 90] GPU 1 | n_heads=88, n_state=16, depth=20 | dim=3328 | 475.4M params
  [Eval 90] Loss: 1.5159
  [Eval 91] GPU 2 | n_heads=104, n_state=48, depth=21 | dim=896 | 471.9M params
  [Eval 91] Loss: 1.7339
  [Eval 93] GPU 4 | n_heads=82, n_state=16, depth=20 | dim=3584 | 477.1M params
  [Eval 93] Loss: 1.5305
  [Eval 89] GPU 0 | n_heads=68, n_state=16, depth=25 | dim=3456 | 476.9M params
  [Eval 89] Loss: 1.5481
  [Eval 95] GPU 6 | n_heads=83, n_state=32, depth=23 | dim=1536 | 472.5M params
  [Eval 95] Loss: 1.5615
  [Eval 92] GPU 3 | n_heads=71, n_state=16, depth=30 | dim=2816 | 486.7M params
  [Eval 92] Loss: 1.4546
  [Eval 96] GPU 7 | n_heads=103, n_state=32, depth=21 | dim=1408 | 490.7M params
  [Eval 96] Loss: 1.4441
  [Eval 94] GPU 5 | n_heads=76, n_state=32, depth=24 | dim=1664 | 489.1M params
  [Eval 94] Loss: 1.4382
   12     96 1.438245000000000e+00 3.1e+00 2.18e-01  2e-01  3e-01 123:37.3

--- Generation 13/15 ---
  [Eval 100] GPU 3 | n_heads=70, n_state=16, depth=25 | dim=3328 | 472.7M params
  [Eval 100] Loss: 1.5254
  [Eval 104] Skip - params 503.7M vs target 480M
  [Eval 101] GPU 4 | n_heads=75, n_state=16, depth=25 | dim=3200 | 486.9M params
  [Eval 101] Loss: 1.4429
  [Eval 97] GPU 0 | n_heads=67, n_state=32, depth=21 | dim=2176 | 493.5M params
  [Eval 97] Loss: 1.4279
  [Eval 98] GPU 1 | n_heads=74, n_state=16, depth=23 | dim=3456 | 477.4M params
  [Eval 98] Loss: 1.5247
  [Eval 102] GPU 5 | n_heads=68, n_state=32, depth=23 | dim=1920 | 484.0M params
  [Eval 102] Loss: 1.4353
  [Eval 99] GPU 2 | n_heads=69, n_state=32, depth=29 | dim=1536 | 495.3M params
  [Eval 99] Loss: 1.4573
  [Eval 103] GPU 6 | n_heads=68, n_state=32, depth=24 | dim=1792 | 471.4M params
  [Eval 103] Loss: 1.8125
   13    104 1.427920000000000e+00 2.5e+00 2.91e-01  2e-01  3e-01 133:58.6

--- Generation 14/15 ---
  [Eval 110] GPU 5 | n_heads=98, n_state=32, depth=23 | dim=1280 | 464.9M params
  [Eval 110] Loss: 1.5293
  [Eval 111] GPU 6 | n_heads=75, n_state=32, depth=21 | dim=1920 | 487.4M params
  [Eval 111] Loss: 1.4437
  [Eval 106] GPU 1 | n_heads=89, n_state=16, depth=32 | dim=2048 | 473.0M params
  [Eval 106] Loss: 1.6808
  [Eval 109] GPU 4 | n_heads=67, n_state=32, depth=21 | dim=2176 | 493.5M params
  [Eval 109] Loss: 1.4173
  [Eval 107] GPU 2 | n_heads=68, n_state=16, depth=26 | dim=3328 | 477.5M params
  [Eval 107] Loss: 1.5520
  [Eval 105] GPU 0 | n_heads=69, n_state=16, depth=25 | dim=3456 | 483.9M params
  [Eval 105] Loss: 1.4342
  [Eval 108] GPU 3 | n_heads=100, n_state=48, depth=20 | dim=1024 | 493.9M params
  [Eval 108] Loss: 1.6858
  [Eval 112] GPU 7 | n_heads=88, n_state=32, depth=20 | dim=1664 | 472.0M params
  [Eval 112] Loss: 1.7989
   14    112 1.417344000000000e+00 1.7e+00 2.47e-01  2e-01  2e-01 144:17.7

--- Generation 15/15 ---
  [Eval 116] GPU 3 | n_heads=68, n_state=16, depth=23 | dim=3840 | 487.5M params
  [Eval 116] Loss: 1.4069
  [Eval 115] GPU 2 | n_heads=102, n_state=16, depth=20 | dim=2944 | 487.3M params
  [Eval 115] Loss: 1.4430
  [Eval 113] GPU 0 | n_heads=66, n_state=32, depth=23 | dim=1920 | 469.8M params
  [Eval 113] Loss: 1.7828
  [Eval 118] GPU 5 | n_heads=74, n_state=16, depth=23 | dim=3456 | 477.4M params
  [Eval 118] Loss: 1.5352
  [Eval 120] GPU 7 | n_heads=75, n_state=16, depth=26 | dim=3072 | 486.1M params
  [Eval 120] Loss: 1.4493
  [Eval 114] GPU 1 | n_heads=104, n_state=48, depth=22 | dim=896 | 494.3M params
  [Eval 114] Loss: 1.8052
  [Eval 119] GPU 6 | n_heads=65, n_state=32, depth=20 | dim=2304 | 482.9M params
  [Eval 119] Loss: 1.4109
  [Eval 117] GPU 4 | n_heads=74, n_state=32, depth=21 | dim=1920 | 480.9M params
  [Eval 117] Loss: 1.4307
  *** NEW BEST: 1.4069 | {'n_heads': 68, 'n_state': 16, 'depth': 23} | dim=3840 ***
   15    120 1.406915000000000e+00 2.0e+00 2.14e-01  1e-01  2e-01 154:35.2

======================================================================
SEARCH COMPLETE
======================================================================
Best loss: 1.4069
Best params: {'n_heads': 68, 'n_state': 16, 'depth': 23}
Total evaluations: 120

To train with best config:
python train.py --level E88 --dim 3840 --n_heads 68 --n_state 16 --depth 23 --lr 3e-4 --expansion 1.0 --use_gate 1 --gate_activation silu --train_minutes 30
